# WireShark 抓包



### 1. 简述

涉及各大网络协议和四大网络层面，网络知识为主工具为辅助。

注意：下载与安装不在本文范围内

#### 文件

该软件自带中文，文件的打开、保存不在此明细说明的范围内。

注意：保存格式上有一定的区分，请留意

#### 操作

> 1、抓包过滤器语法和实例
>
>   抓包过滤器类型Type（host、net、port）、方向Dir（src、dst）、协议Proto（ether、ip、tcp、udp、http、icmp、ftp等）、逻辑运算符（&& 与、|| 或、！非）
>
> （1）协议过滤
>
>  比较简单，直接在抓包过滤框中直接输入协议名即可。
>
>  tcp，只显示TCP协议的数据包列表
>
>  http，只查看HTTP协议的数据包列表
>
>  icmp，只显示ICMP协议的数据包列表
>
> （2）IP过滤
>
>  host 192.168.1.104
>
>  src host 192.168.1.104
>
>  dst host 192.168.1.104
>
> （3）端口过滤
>
>  port 80
>
>  src port 80
>
>  dst port 80
>
> （4）逻辑运算符&& 与、|| 或、！非
>
>  src host 192.168.1.104 && dst port 80 抓取主机地址为192.168.1.80、目的端口为80的数据包
>
>  host 192.168.1.104 || host 192.168.1.102 抓取主机为192.168.1.104或者192.168.1.102的数据包
>
>  ！broadcast 不抓取广播数据包
>
> 2、显示过滤器语法和实例
>
> （1）比较操作符
>
>  比较操作符有== 等于、！= 不等于、> 大于、< 小于、>= 大于等于、<=小于等于。
>
> （2）协议过滤
>
>  比较简单，直接在Filter框中直接输入协议名即可。**注意：协议名称需要输入小写。**
>
>  tcp，只显示TCP协议的数据包列表
>
>  http，只查看HTTP协议的数据包列表
>
>  icmp，只显示ICMP协议的数据包列表
>
> ![img](https://img2018.cnblogs.com/blog/774327/201812/774327-20181216091233009-756441984.png)
>
> （3） ip过滤
>
>   ip.src ==192.168.1.104 显示源地址为192.168.1.104的数据包列表
>
>   ip.dst==192.168.1.104, 显示目标地址为192.168.1.104的数据包列表
>
>   ip.addr == 192.168.1.104 显示源IP地址或目标IP地址为192.168.1.104的数据包列表
>
> ![img](https://img2018.cnblogs.com/blog/774327/201812/774327-20181216091553689-1436668121.png)
>
> （4）端口过滤
>
>  tcp.port ==80, 显示源主机或者目的主机端口为80的数据包列表。
>
>  tcp.srcport == 80, 只显示TCP协议的源主机端口为80的数据包列表。
>
>  tcp.dstport == 80，只显示TCP协议的目的主机端口为80的数据包列表。
>
> ![img](https://img2018.cnblogs.com/blog/774327/201812/774327-20181216092151712-331226826.png)
>
> （5） Http模式过滤
>
>  http.request.method=="GET",  只显示HTTP GET方法的。
>
> （6）逻辑运算符为 and/or/not
>
>  过滤多个条件组合时，使用and/or。比如获取IP地址为192.168.1.104的ICMP数据包表达式为ip.addr == 192.168.1.104 and icmp

Notes

以上为基本的信息过滤操作，更多请留意文档。

#### 功能

软件自带功能，比如统计、分析、工具、排序、流量



### 2. 实例

Windows Powershell：tasklist、netstat、进程 PID、Find

**2.1 首先必须要有一个目标 IP**

具备网域的信息更为简单，只需要 ping or 反向代理即可找到对应的 IP

对于没有 IP 的应用程序，先抓取 IP，方法示例如下：

1. 使用 Windows Task 或 tasklist 得知目标程序的进程 PID
2. 获得程序的 IP 地址：netstat -aon，寻找目标 PID 对应的　PID
3. 补充：或者单例测试，只运行目标程序

**2.2 WireShark 抓包**

选择相应的网卡，在工具栏中点击"capture "的按钮. 即可开始记录网络请求的信息.

中间有一个输入的方框可以输入"类似正则表达式"的语法对请求进行过滤.

打开具体的信息可以查看应用层的请求数据或状态, 比如 HTTP 协议.



Notes：

学习曲线高（对操作者的网络知识储备要求高）



### 附录

1. [WireShark 抓包教程	-- Blog](https://www.cnblogs.com/linyfeng/p/9496126.html)
2. [WireShark 分析参考](https://zhuanlan.zhihu.com/p/31512066)
3. [WireShark Docs](https://www.wireshark.org/docs/)

